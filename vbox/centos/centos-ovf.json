{
  "variables": {
    "template": "centos-7-x86_64",

    "debug": "false",
    "guest_additions_path": "/tmp/VBoxGuestAdditions.iso",

    "ssh_username": "coadmin",
    "ssh_private_key": "insecure.id_rsa"
  },

  "builders": [
    {
      "type": "virtualbox-ovf",
      "source_path": "output-virtualbox-iso/{{user `template`}}.ovf",

      "communicator": "ssh",
      "headless": false,
      "skip_export": true,

      "vboxmanage": [
        ["modifyvm", "{{.Name}}", "--memory", "1024"],
        ["modifyvm", "{{.Name}}", "--cpus", "1"],
        ["setextradata", "global", "GUI/SuppressMessages", "all"]
      ],

      "vm_name": "{{user `template`}}",

      "guest_additions_mode": "upload",
      "guest_additions_path": "{{user `guest_additions_path`}}",

      "ssh_username": "{{user `ssh_username`}}",
      "ssh_private_key_file": "{{user `ssh_private_key`}}",

      "shutdown_command": "sudo /sbin/poweroff"
    }
  ],

  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "VARA=bar",
        "VARB=Dan's",
        "VARC='Foo'"
      ],
      "inline": [
        "echo \"VARA is ${VARA}\"",
        "echo \"VARB is ${VARB}\"",
        "echo \"VARC is ${VARC}\""
      ]
    }
  ],

  "post-processors": [
    {
      "type": "shell-local",
      "environment_vars": [
        "VAR_LOCALA=bar",
        "VAR_LOCALB=Dan's",
        "VAR_LOCALC='Foo'"
      ],
      "inline": [
        "echo \"VAR_LOCALA is ${VAR_LOCALA}\"",
        "echo \"VAR_LOCALB is ${VAR_LOCALB}\"",
        "echo \"VAR_LOCALC is ${VAR_LOCALC}\""
      ]
    }
  ]
}
